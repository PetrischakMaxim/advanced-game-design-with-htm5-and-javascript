<!doctype html>
<meta charset="utf-8">
<title>Interactive sprites</title>
<script src="../library/plugins/traceur-compiler/bin/traceur.js" type="text/javascript"></script>
<script src="../library/plugins/traceur-compiler/src/bootstrap.js" type="text/javascript"></script>
<script>traceur.options.experimental = true;</script>
<script type="module">

    //Import code from the library
    import {makeCanvas, circle, stage, buttons, render} from "../library/display";
    import {getRandomRgbaColor} from "../library/utilities";
    import {makePointer} from "../library/interactive";

    //Declare any variables shared between functions
    let canvas, ball, box, message, pointer;

    //Make the canvas and initialize the stage
    canvas = makeCanvas(512, 512);
    stage.width = canvas.width;
    stage.height = canvas.height;

    //Make the pointer
    pointer = makePointer(canvas);

    //Create the sprite
    ball = circle(120, "red", "blue", 20);
    stage.putCenter(ball);

    //Make the ball interactive
    ball.interactive = true;

    //Assign the ball's `press` method
    ball.press = () => {

        //Set the ball's `fillStyle` and `strokeStyle` to a random color
        ball.fillStyle = getRandomRgbaColor();
        ball.strokeStyle = getRandomRgbaColor();
    };

    //Start the game loop
    gameLoop();

    function gameLoop() {
        requestAnimationFrame(gameLoop);

        //Update the buttons. (The `ball` was added to the
        //`buttons` array when `ball.interactive` was set to `true`)
        if (buttons.length > 0) {
            canvas.style.cursor = "auto";
            buttons.forEach(button => {
                button.update(pointer, canvas);
                if (button.state === "over" || button.state === "down") {
                    if (button.parent !== undefined) {
                        canvas.style.cursor = "pointer";
                    }
                }
            });
        }

        //Render the canvas
        render(canvas);
    }
</script>
